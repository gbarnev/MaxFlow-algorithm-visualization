<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>MaxFlow algorithm</title>
	<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
	<style type="text/css">
		.graphs {
			height: 500px;
			border: 1px solid lightgray;
		}

		#graphs-flowNetDup {
			columns: 2;
		}

		#buttons-flowNetDup {
			columns: 2;
		}
	</style>
</head>

<body>
	<script src="js/MaxFlow.js"></script>
	<div id="graphs-flowNetDup">
		<div class="graphs" id="flowNet"></div>
		<div class="graphs" hidden=1 id="flowNetDup"></div>
	</div>
	<div id="buttons-flowNetDup">
		<button type="button" onclick="displayRandomGraph()">RANDOM GRAPH</button>
		<button type="button" onclick="runEdmondsKarpAlgorithm()">RUN EDMONDS-KARP</button>
	</div>

	<script type="text/javascript">

		var graph = generateRandomFlowNetwork();

		const nodesVisual = [...graph.connections.keys()].map(
			verticeId => { return { id: verticeId, label: "Node " + verticeId } });
		const edgesVisual = graph.edges.map(
			edge => { return { from: edge.from, to: edge.to, label: edge.flow + "/" + edge.cap, length: 250 } });

		var nodesDataSet = new vis.DataSet(nodesVisual);
		var edgesDataSet = new vis.DataSet(edgesVisual);

		// create a network
		var flowNetContainer = document.getElementById('flowNet');
		var flowNetContainerDup = document.getElementById('flowNetDup');
		var data = {
			nodes: nodesDataSet,
			edges: edgesDataSet
		};
		var options = {
			configure:
			{
				enabled: false
			},
			edges:
			{
				arrows:
				{
					to: { enabled: true, scaleFactor: 0.5 }
				}, smooth: false
			},
			physics: {
				enabled: false
			}
		};
		var visNet = new vis.Network(flowNetContainer, data, options);
		var visNetResidual = new vis.Network(flowNetContainerDup, data, options);

		function displayRandomGraph() {
			graph = generateRandomFlowNetwork();
			const nodesVisual = [...graph.connections.keys()].map(
				verticeId => { return { id: verticeId, label: "Node " + verticeId } });
			const edgesVisual = graph.edges.map(
				edge => { return { from: edge.from, to: edge.to, label: edge.flow + "/" + edge.cap, length: 250 } });

			nodesDataSet.clear();
			edgesDataSet.clear();
			nodesDataSet.add(nodesVisual);
			edgesDataSet.add(edgesVisual);
			visNet.stabilize();
		}

		function runEdmondsKarpAlgorithm() {
			for (let step of EdmondsKarp(graph)) {
				switch (step.type) {
					case AlgoStatesEnum.INIT_RESIDUAL:
						console.log("INIT_RESIDUAL");
						break;
					case AlgoStatesEnum.ADD_EDGE_RESIDUAL:
						console.log("ADD_EDGE_RESIDUAL");
						break;
					case AlgoStatesEnum.FIND_PATH_RESIDUAL:
						console.log("FIND_PATH_RESIDUAL");
						break;
					case AlgoStatesEnum.MIN_FLOW_INCREASE:
						console.log("MIN_FLOW_INCREASE");
						break;
					case AlgoStatesEnum.FINAL_CALC_MAXFLOW:
						console.log("FINAL_CALC_MAXFLOW");
						break;
				}
			}
		}
	</script>
</body>
</html>